{% extends "base.html" %}
{% block title %}Manage Games - NFL Pick'em{% endblock %}
{% block content %}
<h2 class="mb-4"><i class="bi bi-calendar-week me-2"></i>Manage Games</h2>
<div class="card shadow-sm mb-4"><div class="card-body">
    <form method="GET" action="{{ url_for('admin.games') }}" class="row g-3 align-items-end">
        <div class="col-auto"><label class="form-label">Season</label><input type="number" name="season" class="form-control" value="{{ season }}" min="2020" max="2030"></div>
        <div class="col-auto"><label class="form-label">Week</label><input type="number" name="week" class="form-control" value="{{ week }}" min="1" max="18"></div>
        <div class="col-auto"><button type="submit" class="btn btn-primary"><i class="bi bi-search me-1"></i>View</button></div>
    </form>
</div></div>
<div class="d-flex gap-2 mb-4 flex-wrap">
    <form method="POST" action="{{ url_for('admin.import_odds') }}" class="d-inline">{{ import_form.hidden_tag() }}<input type="hidden" name="week" value="{{ week }}"><input type="hidden" name="season" value="{{ season }}"><button type="submit" class="btn btn-success"><i class="bi bi-cloud-download me-1"></i>Import Spreads from API</button></form>
    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addGameModal"><i class="bi bi-plus-lg me-1"></i>Add Game Manually</button>
    <form method="POST" action="{{ url_for('admin.recalculate') }}" class="d-inline"><input type="hidden" name="season" value="{{ season }}"><input type="hidden" name="week" value="{{ week }}"><button type="submit" class="btn btn-outline-warning"><i class="bi bi-calculator me-1"></i>Recalculate Week {{ week }}</button></form>
    <form method="POST" action="{{ url_for('admin.recalculate') }}" class="d-inline"><input type="hidden" name="season" value="{{ season }}"><input type="hidden" name="week" value="0"><button type="submit" class="btn btn-outline-danger"><i class="bi bi-calculator me-1"></i>Recalculate All Weeks</button></form>
</div>
<div class="card shadow-sm"><div class="card-header"><h5 class="mb-0">Week {{ week }} &mdash; {{ season }} Season ({{ games|length }} games)</h5></div>
<div class="table-responsive"><table class="table table-hover mb-0"><thead><tr><th>Away</th><th></th><th>Home</th><th>Spread</th><th>Game Time (UTC)</th><th>Score</th><th>Status</th><th>Actions</th></tr></thead><tbody>
{% for game in games %}<tr>
<td class="fw-semibold">{{ game.away_team }}</td><td class="text-muted">@</td><td class="fw-semibold">{{ game.home_team }}</td>
<td><span class="badge spread-badge {% if game.spread > 0 %}spread-fav{% elif game.spread < 0 %}spread-dog{% else %}spread-even{% endif %}">{{ game.spread_display }}</span></td>
<td>{{ game.game_time.strftime('%a %m/%d %I:%M %p') }}</td>
<td>{% if game.is_final %}{{ game.away_score }} - {{ game.home_score }}{% else %}<span class="text-muted">--</span>{% endif %}</td>
<td>{% if game.is_final %}<span class="badge bg-success">Final</span>{% elif game.has_started %}<span class="badge bg-warning text-dark">In Progress</span>{% else %}<span class="badge bg-info">Upcoming</span>{% endif %}</td>
<td><form method="POST" action="{{ url_for('admin.delete_game', game_id=game.id) }}" onsubmit="return confirm('Delete this game?');" class="d-inline"><button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button></form></td>
</tr>{% endfor %}
{% if not games %}<tr><td colspan="8" class="text-center text-muted py-4">No games for Week {{ week }}. Import spreads or add games manually.</td></tr>{% endif %}
</tbody></table></div></div>
<div class="modal fade" id="addGameModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
<form method="POST" action="{{ url_for('admin.add_game') }}">{{ manual_form.hidden_tag() }}
<div class="modal-header"><h5 class="modal-title"><i class="bi bi-plus-lg me-2"></i>Add Game</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body"><input type="hidden" name="week" value="{{ week }}"><input type="hidden" name="season" value="{{ season }}">
<div class="mb-3"><label class="form-label">Away Team</label>{{ manual_form.away_team(class="form-control", placeholder="e.g. Jets") }}</div>
<div class="mb-3"><label class="form-label">Home Team</label>{{ manual_form.home_team(class="form-control", placeholder="e.g. Dolphins") }}</div>
<div class="mb-3"><label class="form-label">Spread (positive = home favored)</label>{{ manual_form.spread(class="form-control", placeholder="e.g. 7.5") }}</div>
<div class="mb-3"><label class="form-label">Game Time (UTC)</label>{{ manual_form.game_time(class="form-control", placeholder="2025-09-07 17:00") }}</div>
</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary">Add Game</button></div>
</form></div></div></div>
{% endblock %}
