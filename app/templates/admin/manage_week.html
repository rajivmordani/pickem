{% extends "base.html" %}
{% block title %}Week {{ week.week_number }} - Admin{% endblock %}
{% block content %}
<div class="page-header"><h1>Week {{ week.week_number }} &mdash; {{ week.season.year }}</h1></div>
<div class="d-flex gap-2 mb-4 flex-wrap">
    <form method="POST" action="{{ url_for('admin.toggle_picks', week_id=week.id) }}" class="d-inline"><button type="submit" class="btn {% if week.is_open_for_picks %}btn-warning{% else %}btn-success{% endif %}">{% if week.is_open_for_picks %}Close Picks{% else %}Open Picks{% endif %}</button></form>
    <form method="POST" action="{{ url_for('admin.fetch_odds', week_id=week.id) }}" class="d-inline"><button type="submit" class="btn btn-primary">Fetch Games & Odds</button></form>
    <form method="POST" action="{{ url_for('admin.calculate_results', week_id=week.id) }}" class="d-inline"><button type="submit" class="btn btn-outline-info">Calculate Results</button></form>
    {% if not week.is_completed %}<form method="POST" action="{{ url_for('admin.complete_week', week_id=week.id) }}" class="d-inline" onsubmit="return confirm('Mark completed?');"><button type="submit" class="btn btn-outline-success">Mark Completed</button></form>{% else %}<span class="btn btn-success disabled">Completed</span>{% endif %}
    <a href="{{ url_for('admin.seasons') }}" class="btn btn-outline-light">Back</a>
</div>
<div class="card">
    <div class="card-header"><h5 class="mb-0">Games ({{ games|length }})</h5></div>
    <form method="POST" action="{{ url_for('admin.save_scores', week_id=week.id) }}">
    <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover mb-0">
        <thead><tr><th>Away</th><th></th><th>Home</th><th>Spread</th><th>Time</th><th>Away Score</th><th>Home Score</th><th>Status</th><th></th></tr></thead>
        <tbody>
        {% for game in games %}<tr>
            <td class="fw-semibold">{{ game.away_team }}</td><td class="text-muted">@</td><td class="fw-semibold">{{ game.home_team }}</td>
            <td>{% if game.spread is not none %}{{ game.spread_display }}{% else %}N/A{% endif %}</td>
            <td>{% if game.game_time %}{{ game.game_time.strftime('%a %m/%d %I:%M %p') }}{% else %}TBD{% endif %}</td>
            <td><input type="number" name="away_score_{{ game.id }}" class="form-control form-control-sm" value="{{ game.away_score if game.away_score is not none else '' }}" min="0" style="width:80px;"></td>
            <td><input type="number" name="home_score_{{ game.id }}" class="form-control form-control-sm" value="{{ game.home_score if game.home_score is not none else '' }}" min="0" style="width:80px;"></td>
            <td>{% if game.is_final %}<span class="badge bg-success">Final</span>{% elif game.has_started %}<span class="badge bg-warning text-dark">Live</span>{% else %}<span class="badge bg-info">Upcoming</span>{% endif %}</td>
            <td><form method="POST" action="{{ url_for('admin.delete_game', game_id=game.id) }}" onsubmit="return confirm('Delete?');" class="d-inline"><button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button></form></td>
        </tr>{% endfor %}
        {% if not games %}<tr><td colspan="9" class="text-center text-muted py-4">No games. Use Fetch Games & Odds.</td></tr>{% endif %}
        </tbody>
    </table></div></div>
    {% if games %}<div class="card-footer"><button type="submit" class="btn btn-primary">Save Scores</button></div>{% endif %}
    </form>
</div>
{% endblock %}
