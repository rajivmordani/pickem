{% extends "base.html" %}
{% block title %}Yearly Standings - NFL Pick'em{% endblock %}
{% block content %}
<div class="page-header">
    <h1><i class="bi bi-trophy me-2"></i>{{ season }} Season Standings</h1>
    <p>Yearly & Weekly Prize Race</p>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <ul class="nav nav-pills">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('standings.weekly', season=season) }}"><i class="bi bi-calendar-week me-1"></i>Weekly</a></li>
        <li class="nav-item"><a class="nav-link active" href="{{ url_for('standings.yearly', season=season) }}"><i class="bi bi-trophy me-1"></i>Yearly</a></li>
    </ul>
</div>

{% if prizes %}
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="stat-value">${{ prizes.yearly_prize_total|round(0)|int }}</div>
            <div class="stat-label">Yearly Prize</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="stat-value">${{ prizes.weekly_prize_total|round(0)|int }}</div>
            <div class="stat-label">Weekly Prize</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stats-card">
            <div class="stat-value">{{ prizes.num_players }}</div>
            <div class="stat-label">Players</div>
        </div>
    </div>
</div>
{% endif %}

{% if standings %}
<div class="card mb-4">
    <div class="card-header"><h5 class="mb-0"><i class="bi bi-trophy-fill me-2" style="color: gold;"></i>Season Standings</h5></div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>#</th><th>Player</th><th class="text-center">Total Points</th>
                        <th class="text-center">Winning Picks</th><th class="text-center">Weekly Wins</th>
                        <th class="text-center">Weeks Played</th><th class="text-center">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_id, data in standings %}
                    <tr class="{{ 'winner-glow' if user_id in yearly_winner_ids }}">
                        <td>{{ loop.index }}</td>
                        <td class="fw-bold text-nowrap">
                            {{ user_map[user_id].username }}
                            {% if user_id in yearly_winner_ids %}<i class="bi bi-trophy-fill ms-1" style="color: gold;" title="Yearly Prize Leader"></i>{% endif %}
                            {% if user_id in weekly_winner_ids %}<i class="bi bi-calendar-check ms-1" style="color: #4fc3f7;" title="Weekly Prize Leader"></i>{% endif %}
                        </td>
                        <td class="text-center fw-bold fs-5">
                            <span class="{{ 'points-positive' if data.total_points > 0 else 'points-negative' if data.total_points < 0 else 'points-zero' }}">{{ '%+.1f'|format(data.total_points) }}</span>
                        </td>
                        <td class="text-center">{{ data.total_winning_picks }}</td>
                        <td class="text-center">
                            {% if data.total_weekly_wins > 0 %}<span class="badge bg-warning text-dark">{{ '%.1f'|format(data.total_weekly_wins) }}</span>
                            {% else %}<span class="text-white-50">0</span>{% endif %}
                        </td>
                        <td class="text-center">{{ data.weeks_played }}</td>
                        <td class="text-center"><span class="badge bg-success">Active</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% else %}
<div class="text-center py-5">
    <i class="bi bi-hourglass" style="font-size: 3rem; color: rgba(255,255,255,0.3);"></i>
    <h3 class="mt-3 text-white-50">No Results Yet</h3>
    <p class="text-white-50">Standings will appear after the first week is completed.</p>
</div>
{% endif %}
{% endblock %}
